openapi: 3.0.3
info:
  title: Biograf Reservation API
  version: 1.0.0
  description: >
    API til reservation af biografforestillinger (ingen betaling, ingen sædenumre).
    Brugeren vælger film + tidspunkt i UI; klienten bruger forestillingId i POST.

servers:
  - url: http://localhost:8080/booking/api

paths:
  /forestillinger:
    get:
      summary: Hent liste af forestillinger inkl. ledige pladser
      description: Returnerer alle forestillinger (evt. filtreret på dato) med antal ledige pladser.
      parameters:
        - name: dato
          in: query
          required: false
          description: Filtrer forestillinger på en bestemt dato (YYYY-MM-DD)
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Liste af forestillinger
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Forestilling'
        '400':
          description: Ugyldigt parameter (fx forkert datoformat)

  /reservationer:
    post:
      summary: Opret ny reservation
      description: >
        Opretter en reservation for én eller flere pladser til én eller flere forestillinger.
        Ingen sædenumre – kun antal pladser pr. forestilling.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OpretReservationRequest'
            examples:
              eksempel:
                value:
                  posts:
                    - forestillingId: 101
                      antalPladser: 2
                    - forestillingId: 205
                      antalPladser: 3
      responses:
        '201':
          description: Reservation oprettet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reservation'
        '400':
          description: Ugyldig request (fx manglende felter, antalPladser <= 0)
        '409':
          description: Ikke nok ledige pladser (konflikt)

  /reservationer/{reservationId}:
    delete:
      summary: Aflys reservation
      description: Aflyser en eksisterende reservation og frigiver de reserverede pladser.
      parameters:
        - name: reservationId
          in: path
          required: true
          description: ID på reservationen der skal aflyses
          schema:
            type: integer
            example: 9001
      responses:
        '204':
          description: Reservation aflyst
        '404':
          description: Reservation ikke fundet

components:
  schemas:
    Forestilling:
      type: object
      properties:
        id:
          type: integer
          example: 101
          description: Teknisk nøgle til brug i efterfølgende reservation
        filmTitel:
          type: string
          example: "Once Upon Time in America"
        startTid:
          type: string
          format: date-time
          example: "2026-01-19T19:30:00+01:00"
        totalPladser:
          type: integer
          example: 50
        ledigePladser:
          type: integer
          example: 42
        sal:
          $ref: '#/components/schemas/Sal'
      required:
        - id
        - filmTitel
        - startTid
        - totalPladser
        - ledigePladser
        - sal


    OpretReservationRequest:
      type: object
      properties:
        posts:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/ReservationsPostInput'
      required:
        - posts

    ReservationsPostInput:
      type: object
      properties:
        forestillingId:
          type: integer
          example: 101
        antalPladser:
          type: integer
          minimum: 1
          example: 2
      required:
        - forestillingId
        - antalPladser

    Reservation:
      type: object
      properties:
        id:
          type: integer
          example: 9001
        oprettetTid:
          type: string
          format: date-time
          example: "2026-01-19T10:45:00+01:00"
        kunde:
          $ref: '#/components/schemas/Kunde'
        posts:
          type: array
          items:
            $ref: '#/components/schemas/ReservationsPost'
      required:
        - id
        - oprettetTid
        - kunde
        - posts

    ReservationsPost:
      type: object
      properties:
        forestillingId:
          type: integer
          example: 101
        antalPladser:
          type: integer
          example: 2
      required:
        - forestillingId
        - antalPladser
    Kunde:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        navn:
          type: string
          example: "Jens Janson"
        email:
          type: string
          example: "janson@example.com"
      required:
        - id
        - navn
        - email

    Sal:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 3
        navn:
          type: string
          example: "Sal 3"
        kapacitet:
          type: integer
          example: 50
      required:
        - id
        - navn
        - kapacitet
